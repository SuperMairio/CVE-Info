import csv
import time
from ares import CVESearch
csvContent = []

# Removes duplicates from csv file
def SortCVEs():
    with open("cve.csv") as csvfile:
        cveReader = csv.reader(csvfile, delimiter=",")
        for i in cveReader:
            csvContent.append(i)

    cves = list(dict.fromkeys(csvContent[0]))

    return cves

# Get score and summary for each CVE
def GetInfo(cves):
    cveSearch = CVESearch() 
    with open("output.csv", "w", newline="") as humanReadable: 
        with open("boringOutput.csv", "w", newline="") as excelReadable:
            writeHR = csv.writer(humanReadable)
            writeER = csv.writer(excelReadable)
            
            writeER.writerow(["CVE ID",
            "CVSS",
            "SUMMARY",
            "ACCESS - AUTHENTICATION",
            "ACCESS - COMPLEXITY",
            "ACCESS - VECTOR",
            "IMPACT - CONFIDENTIALITY",
            "IMPACT - INTEGRITY",
            "IMPACT - AVAILABILITY"])

            for c in cves:
                fullOutput = cveSearch.id(c)
                writeHR.writerow(["-----"])
                writeHR.writerow([str(c)])
                writeHR.writerow([str(fullOutput["cvss"])])
                writeHR.writerow([str(fullOutput["summary"])])
                writeHR.writerow([str(fullOutput["access"])])
                writeHR.writerow([str(fullOutput["impact"])])

                writeER.writerow([
                    str(c),
                    str(fullOutput["cvss"]),
                    str(fullOutput["summary"]),
                    str(fullOutput["access"]["authentication"]),
                    str(fullOutput["access"]["complexity"]),
                    str(fullOutput["access"]["vector"]),
                    str(fullOutput["impact"]["confidentiality"]),
                    str(fullOutput["impact"]["integrity"]),
                    str(fullOutput["impact"]["availability"])
                    ])
                print("Looking up: ",c)
                time.sleep(1)

cves = SortCVEs()
#cves = ["CVE-2021-3193","CVE-2021-21285"] #for testing
GetInfo(cves)
print("Done!")